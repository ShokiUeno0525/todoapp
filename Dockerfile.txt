# ─────────────────────────────────────────────────
#  Laravel + Apache + PHP 8.1 用 Dockerfile
# ─────────────────────────────────────────────────

# 1. ベースイメージに apache付きPHP8.1 を使う
FROM php:8.1-apache

# 2. システムパッケージのインストール & 必要な PHP 拡張を有効化
RUN apt-get update && apt-get install -y \
      git \
      zip \
      unzip \
      libpng-dev \
      libonig-dev \
      libxml2-dev \
      default-mysql-client \
  && docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*

# 3. Composer をインストール
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer

# 4. Apache の rewrite モジュールを有効化
RUN a2enmod rewrite

# 5. 作業ディレクトリを /var/www/html に設定
WORKDIR /var/www/html

# 6. マウントされたソースの所有者を www-data に変更（パーミッション用）
RUN chown -R www-data:www-data /var/www/html

# 7. デフォルトの Apache ドキュメントルートを Laravel public に向ける設定（任意）
#    ※ 必要な場合は .htaccess レベルで調整するか、以下のように VirtualHost を上書きしてください。  
#    例）デフォルトの 000-default.conf をカスタマイズして /var/www/html/public を DocumentRoot にするなら、
#    COPY ./docker/vhost.conf /etc/apache2/sites-available/000-default.conf
#
#    （今回は基本サンプルのため省略します。Laravel標準の public/index.php を動かすだけなら不要です）

